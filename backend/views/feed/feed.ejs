<%- include('../partials/header', { title: 'Feed' }) %>
<%- include('../partials/navbar') %>

<div class="container">
  <h2>Your Feed</h2>
  <% if (posts && posts.length) { %>
    <% posts.forEach(post => { %>
      <div class="post-card">
        <div style="display:flex; gap:10px; align-items:center;">
          <img src="<%= post.author.avatarUrl || 'https://via.placeholder.com/48' %>" style="width:48px;height:48px;border-radius:24px" />
          <div>
            <strong><%= post.author.name %></strong><br />
            <small><%= new Date(post.createdAt).toLocaleString() %></small>
          </div>
        </div>
        <div style="margin-top:8px"><%= post.text %></div>
        <% if (post.mediaUrls && post.mediaUrls.length) { %>
          <% post.mediaUrls.forEach(m => { %>
            <% if (m.match(/\.(mp4|webm)$/i)) { %>
              <video controls style="width:100%; margin-top:10px" src="<%= m %>"></video>
            <% } else if (m.match(/\.(mp3|wav|m4a)$/i)) { %>
              <audio controls src="<%= m %>" style="width:100%"></audio>
            <% } else { %>
              <img src="<%= m %>" style="width:100%; margin-top:10px" />
            <% } %>
          <% }) %>
        <% } %>
      </div>
    <% }) %>
  <% } else { %>
    <p>No posts yet.</p>
  <% } %>
</div>

<%- include('../partials/footer') %>
